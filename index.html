<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YODDA Premium v3.0 - Enterprise AI Builder</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #fff; background: #020617; }
        .aurora-bg { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(125% 125% at 50% 0%, rgba(2,6,23,0.8) 50%, transparent), linear-gradient(135deg, rgba(0,255,0,0.1), rgba(0,0,255,0.1), rgba(255,0,255,0.1)); background-size: 400% 400%; animation: auroraShift 20s ease infinite, auroraGlow 5s ease-in-out infinite alternate; z-index: -1; filter: blur(20px); }
        @keyframes auroraShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes auroraGlow { 0% { opacity: 0.6; } 100% { opacity: 1; } }
        .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(2,6,23,0.7); z-index: -1; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 20px; background: rgba(0,0,0,0.5); border-radius: 10px; margin-bottom: 20px; }
        nav { display: flex; justify-content: space-around; margin-bottom: 20px; }
        button, .button { background: linear-gradient(135deg, #23d5ab, #23a6d5); border: none; color: #fff; padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: transform 0.3s, box-shadow 0.3s; text-decoration: none; display: inline-block; text-align: center;}
        button:hover, .button:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(35,213,171,0.5); }
        button:disabled { background: #555; cursor: not-allowed; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); justify-content: center; align-items: center; z-index: 10; }
        .modal-content { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 20px; border-radius: 10px; width: 300px; text-align: center; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        input, select { display: block; width: 100%; box-sizing: border-box; margin: 10px 0; padding: 10px; border: 1px solid #23a6d5; border-radius: 5px; background: rgba(255,255,255,0.05); color: #fff; }
        select option { background: #020617; color: #fff; }
        #dashboard { display: none; }
        #result { padding: 20px; background: rgba(0,0,0,0.7); border-left: 3px solid #23d5ab; border-radius: 10px; white-space: pre-wrap; font-family: 'Courier New', Courier, monospace; max-height: 400px; overflow-y: auto; margin-top: 20px;}
        #preview-btn { display: none; margin-top: 10px; }
        .eye-icon { cursor: pointer; position: absolute; right: 10px; top: 50%; transform: translateY(-50%); }
        .admin-actions { display: flex; gap: 10px; align-items: center; }
        #validation-status { font-size: 0.9em; margin-left: 10px; }
        .status-success { color: #23d5ab; }
        .status-error { color: #ff4d4d; }
    </style>
</head>
<body>
    <div class="aurora-bg"></div>
    <div class="overlay"></div>
    <div class="container">
        <header><h1>Yodda</h1><p>Enterprise AI Builder</p></header>
        <nav id="main-nav">
            <button id="login-nav-btn" onclick="showModal('login')">Login</button>
            <button id="register-nav-btn" onclick="showModal('register')">Register</button>
            <button id="logout-nav-btn" style="display:none;" onclick="logout()">Logout</button>
        </nav>
        <div id="dashboard">
            <h2>Welcome, <span id="user-email"></span> (<span id="user-tier"></span>)</h2>
            <select id="platform-select"><option value="web">Web</option><option value="desktop">Desktop</option></select>
            <select id="theme-select"><option value="dark-pro">Dark Professional</option><option value="light-modern">Light Modern</option></select>
            <input id="query-input" placeholder="Enter query (e.g., create a landing page for a SaaS)" />
            <button onclick="orchestrate()">Build with Agents</button>
            <div id="result"></div>
            <button id="preview-btn" onclick="previewCode()">Preview</button>
            <div id="admin-panel" style="display:none; margin-top: 30px;">
                <h3>Admin Panel: Manage API Keys</h3>
                <input id="manage-user-email" placeholder="User Email (leave blank for self)" />
                <select id="manage-provider">
                    <option value="groq">Groq</option>
                    <option value="nvidia">NVIDIA</option>
                    <option value="google_gemini">Google Gemini</option>
                    <option value="google_ai_studio">Google AI Studio</option>
                    <option value="huggingface">Hugging Face</option>
                </select>
                <input id="manage-key" placeholder="API Key" />
                <div class="admin-actions">
                    <button onclick="managePlugin()">Save API Key</button>
                    <button id="validate-btn" onclick="validateKey()">Validate Key</button>
                    <span id="validation-status"></span>
                </div>
            </div>
        </div>
    </div>

    <div id="login-modal" class="modal"><div class="modal-content"><h2>Login</h2><input id="login-email" placeholder="Email" /><div style="position: relative;"><input id="login-password" type="password" placeholder="Password" /><span class="eye-icon" onclick="togglePassword('login-password')">üëÅÔ∏è</span></div><button onclick="login()">Submit</button><button onclick="closeModal('login')">Close</button></div></div>
    <div id="register-modal" class="modal"><div class="modal-content"><h2>Register</h2><input id="reg-name" placeholder="Name" /><input id="reg-email" placeholder="Email" /><div style="position: relative;"><input id="reg-password" type="password" placeholder="Password" /><span class="eye-icon" onclick="togglePassword('reg-password')">üëÅÔ∏è</span></div><button onclick="register()">Submit</button><button onclick="closeModal('register')">Close</button></div></div>

    <script>
        const API_URL = 'https://159.65.144.25';
        let generatedCode = ''; 

        function showModal(type) { document.getElementById(`${type}-modal`).style.display = 'flex'; }
        function closeModal(type) { document.getElementById(`${type}-modal`).style.display = 'none'; }
        function getToken() { return localStorage.getItem('token'); }
        function setToken(token) { localStorage.setItem('token', token); }
        function logout() { localStorage.removeItem('token'); alert('Logged out'); window.location.reload(); }

        async function apiCall(endpoint, method = 'GET', body = null) {
            const headers = { 'Content-Type': 'application/json' };
            const token = getToken();
            if (token) headers['Authorization'] = `Bearer ${token}`;
            const res = await fetch(`${API_URL}${endpoint}`, { method, headers, body: body ? JSON.stringify(body) : null });
            if (!res.ok) {
                const errorText = await res.text();
                let errorDetail = errorText;
                try {
                    const errorJson = JSON.parse(errorText);
                    errorDetail = (errorJson.detail && typeof errorJson.detail === 'object') ? JSON.stringify(errorJson.detail) : errorJson.detail || errorText;
                } catch (e) {}
                throw new Error(errorDetail);
            }
            return res.json();
        }

        async function login() {
            try {
                const data = await apiCall('/auth/login', 'POST', { email: document.getElementById('login-email').value, password: document.getElementById('login-password').value });
                setToken(data.token);
                closeModal('login');
                showDashboard();
            } catch (e) { alert('Login Error: ' + e.message); }
        }

        async function register() {
            try {
                await apiCall('/auth/register', 'POST', { name: document.getElementById('reg-name').value, email: document.getElementById('reg-email').value, password: document.getElementById('reg-password').value });
                alert('Registered successfully! Please log in.');
                closeModal('register');
            } catch (e) { alert('Registration Error: ' + e.message); }
        }

        async function showDashboard() {
            if (!getToken()) return;
            document.getElementById('login-nav-btn').style.display = 'none';
            document.getElementById('register-nav-btn').style.display = 'none';
            document.getElementById('logout-nav-btn').style.display = 'inline-block';
            document.getElementById('dashboard').style.display = 'block';

            try {
                const user = await apiCall('/auth/me');
                document.getElementById('user-email').textContent = user.email;
                document.getElementById('user-tier').textContent = user.tier;
                if (user.is_admin) document.getElementById('admin-panel').style.display = 'block';
            } catch (e) { alert('Error loading dashboard: ' + e.message); logout(); }
        }

        async function orchestrate() {
            const resultDiv = document.getElementById('result');
            const previewBtn = document.getElementById('preview-btn');
            resultDiv.textContent = 'Generating code with AI agent...';
            previewBtn.style.display = 'none';
            generatedCode = '';

            try {
                const result = await apiCall('/api/v1/swarm/orchestrate', 'POST', { query: document.getElementById('query-input').value, platform: document.getElementById('platform-select').value, theme: document.getElementById('theme-select').value });
                if (result && result.generated_code) {
                    generatedCode = result.generated_code;
                    resultDiv.textContent = generatedCode;
                    previewBtn.style.display = 'block';
                } else {
                    resultDiv.textContent = JSON.stringify(result, null, 2);
                }
            } catch (e) { resultDiv.textContent = 'Error: ' + e.message; }
        }

        function previewCode() {
            if (generatedCode) {
                const previewWindow = window.open();
                previewWindow.document.write(generatedCode);
                previewWindow.document.close();
            }
        }

        async function managePlugin() {
            try {
                const result = await apiCall('/api/v1/admin/plugins', 'POST', {
                    user_email: document.getElementById('manage-user-email').value,
                    provider: document.getElementById('manage-provider').value,
                    key: document.getElementById('manage-key').value,
                    type: 'text' 
                });
                alert(result.message);
            } catch (e) { alert('Save Error: ' + e.message); }
        }
        
        async function validateKey() {
            const provider = document.getElementById('manage-provider').value;
            const key = document.getElementById('manage-key').value;
            const statusEl = document.getElementById('validation-status');
            const validateBtn = document.getElementById('validate-btn');
            if (!key) { alert('Please enter an API key to validate.'); return; }

            statusEl.textContent = 'Validating...';
            statusEl.className = '';
            validateBtn.disabled = true;
            
            try {
                const result = await apiCall('/api/v1/admin/validate_key', 'POST', { provider, key });
                statusEl.textContent = result.message;
                statusEl.className = 'status-success';
            } catch (e) {
                statusEl.textContent = 'Validation Failed: ' + e.message;
                statusEl.className = 'status-error';
            } finally {
                validateBtn.disabled = false;
            }
        }

        function togglePassword(id) {
            const input = document.getElementById(id);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        if (getToken()) { showDashboard(); }
    </script>
</body>
</html>
